{% extends template('widget') %}

{% define data = {
    quote: _widget.quote,
    orderCustomReference: _widget.quote.orderCustomReference,
    orderCustomReferenceForm: _widget.orderCustomReferenceForm,
    isEditable: _widget.isEditable,
    isGuest: _widget.isGuest,
} %}

{% block body %}
    {% set canWrite = data.isEditable or can('WriteSharedCartPermissionPlugin', data.quote.idQuote) %}

    {% block orderCustomReference %}
        {% if canWrite %}
            {% block referenceForm %}
                {% include molecule('order-custom-reference-form', 'OrderCustomReferenceWidget') with {
                    data: {
                        form: data.orderCustomReferenceForm
                    },
                } only %}
            {% endblock %}
        {% endif %}

        {% if not canWrite and not data.isGuest %}
            {% block referenceView %}
                {% include molecule('order-custom-reference-view', 'OrderCustomReferenceWidget') with {
                    data: {
                        orderCustomReference: data.quote.orderCustomReference,
                    },
                } only %}
            {% endblock %}
        {% endif %}

        {% if data.isGuest %}
            {% block referenceCartView %}
                <input placeholder="{{ 'order_custom_reference.placeholder.login' | trans }}"
                       value="{{ data.orderCustomReference }}"
                       class="input input--expand" disabled>
            {% endblock %}
        {% endif %}
    {% endblock %}
{% endblock %}
