{% extends template('widget') %}

{% define data = {
    quote: _widget.quote,
    orderCustomReference: _widget.quote.orderCustomReference,
    orderCustomReferenceForm: _widget.orderCustomReferenceForm,
} %}

{% block body %}
    {% set canWrite = data.quote is not empty and (is_granted('ROLE_USER') or can('WriteSharedCartPermissionPlugin', data.quote.idQuote)) %}

    {% block orderCustomReference %}
        {% if canWrite %}
            {% block referenceForm %}
                {% include molecule('order-custom-reference-form', 'OrderCustomReferenceWidget') with {
                    data: {
                        form: data.orderCustomReferenceForm
                    },
                } only %}
            {% endblock %}
        {% endif %}

        {% if not canWrite and data.orderCustomReference %}
            {% block referenceView %}
                {% include molecule('order-custom-reference-view', 'OrderCustomReferenceWidget') with {
                    data: {
                        orderCustomReference: data.quote.orderCustomReference,
                    },
                } only %}
            {% endblock %}
        {% endif %}
    {% endblock %}
{% endblock %}
